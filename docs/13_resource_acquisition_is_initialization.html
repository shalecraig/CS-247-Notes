<!DOCTYPE html>  <html> <head>   <title>13_resource_acquisition_is_initialization.cpp</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="05_tut1.html">                 05_tut1.cpp               </a>                                           <a class="source" href="06_adt_design.html">                 06_adt_design.cpp               </a>                                           <a class="source" href="07_handle_classes.html">                 07_handle_classes.cpp               </a>                                           <a class="source" href="08_designing_an_adt.html">                 08_designing_an_adt.cpp               </a>                                           <a class="source" href="09_mutable_adts.html">                 09_mutable_adts.cpp               </a>                                           <a class="source" href="10_singleton_design.html">                 10_singleton_design.cpp               </a>                                           <a class="source" href="11_error_handling.html">                 11_error_handling.cpp               </a>                                           <a class="source" href="12_exceptions.html">                 12_exceptions.cpp               </a>                                           <a class="source" href="13_resource_acquisition_is_initialization.html">                 13_resource_acquisition_is_initialization.cpp               </a>                                           <a class="source" href="14_make.html">                 14_make.sh               </a>                                           <a class="source" href="15_makefile.html">                 15_makefile.mak               </a>                                           <a class="source" href="16_interface_specifications.html">                 16_interface_specifications.h               </a>                                           <a class="source" href="17_namespaces.html">                 17_namespaces.cpp               </a>                                           <a class="source" href="18_namespaces_example.html">                 18_namespaces_example.cpp               </a>                                           <a class="source" href="19_uml.html">                 19_uml.cpp               </a>                                           <a class="source" href="20_substitutability.html">                 20_substitutability.cpp               </a>                                           <a class="source" href="AccountExample.html">                 AccountExample.cpp               </a>                                           <a class="source" href="TDD.html">                 TDD.cpp               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               13_resource_acquisition_is_initialization.cpp             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>Resource Acquisition is Iniitialization (RAII) - equates resource management with object lifetime</p>

<ul>
<li><p>resource is allocated in the object's constructor</p></li>
<li><p>resource is released in the object's destructor</p></li>
</ul>

<p>Smart pointer is an ADT that simulates a pointer, but uses RAII to provide other characteristics.</p>

<p>auto_ptr&lt;> is a c++ stl templated object that holds an internal pointer.</p>

<ol>
<li><p>It deallocates the referent automatically when the scope exits</p></li>
<li><p>It ensures the single ownership of an object</p></li>
<li><p>It allows ownership to transfer among auto_ptrs</p></li>
</ol>             </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/* code: */</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <hr />

<p>Auto-pointer interface</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">X</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">auto_ptr</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="k">typedef</span> <span class="n">X</span> <span class="n">element_type</span><span class="p">;</span>
    </pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>can initialize to ptr</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">explicit</span> <span class="n">auto_ptr</span><span class="p">(</span><span class="n">X</span><span class="o">*</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">throw</span> <span class="p">();</span>
    </pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>transfers ownership to new auto_ptr</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">auto_ptr</span><span class="p">(</span><span class="n">auto_ptr</span><span class="o">&amp;</span><span class="p">)</span> <span class="k">throw</span> <span class="p">();</span>
    </pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>transfers ownership from one ptr to another.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">auto_ptr</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span> <span class="p">(</span><span class="n">auto_ptr</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">throw</span> <span class="p">();</span>
    </pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Deallocates memory</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="o">~</span><span class="n">auto_ptr</span><span class="p">()</span> <span class="k">throw</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>allows deferences of ptr.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">X</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">*</span> <span class="p">()</span> <span class="k">const</span> <span class="k">throw</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>returns a pointer</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">X</span><span class="o">*</span> <span class="k">operator</span><span class="o">-&gt;</span><span class="p">()</span> <span class="k">const</span> <span class="k">throw</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>returns a pointer</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">X</span><span class="o">*</span> <span class="n">get</span><span class="p">()</span> <span class="k">const</span> <span class="k">throw</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>returns a pointer, unbind the auto_ptr</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">X</span><span class="o">*</span> <span class="n">release</span><span class="p">()</span> <span class="k">throw</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>deallocates referent, resets auot_ptr to new referrent</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kt">void</span> <span class="n">reset</span><span class="p">(</span><span class="n">X</span><span class="o">*</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">throw</span><span class="p">();</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <hr />             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p><strong>Example of smart pointers being used</strong></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>header for the auto_pointers</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="cp">#include&lt;memory&gt;</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>creates an auto_ptr that points to 0/1</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">auto_ptr</span><span class="o">&lt;</span><span class="n">Rational</span><span class="o">&gt;</span> <span class="n">ar</span> <span class="p">(</span><span class="k">new</span> <span class="n">Rational</span><span class="p">());</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>creates an auto_ptr that points to (another) 0/1</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">auot_ptr</span><span class="o">&lt;</span><span class="n">Rational</span><span class="o">&gt;</span> <span class="n">as</span> <span class="p">(</span><span class="k">new</span> <span class="n">Rational</span><span class="p">());</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>check that auto_ptr is bound defereence &amp; use referent</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="n">ar</span><span class="p">.</span><span class="n">get</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="o">*</span><span class="n">ar</span><span class="p">;</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>at holds ptr to referent and is unbound.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">auto_ptr</span><span class="o">&lt;</span><span class="n">Rational</span><span class="o">&gt;</span> <span class="n">at</span><span class="p">(</span><span class="n">ar</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>ar holds ptr to referent, as becomes unbound.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">ar</span> <span class="o">=</span> <span class="n">as</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>ar's old referent is deallocated</p>

<p>ar holds ptr to new Rational</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">ar</span><span class="p">.</span><span class="n">reset</span><span class="p">(</span><span class="k">new</span> <span class="n">Rational</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>as's referent is deallocated, as is unbound</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">as</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>all deallocations are run.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <hr />             </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/* snip */</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Exceptions - Best Practices</p>

<ol>
<li><p>Signal all errors as exceptions</p></li>
<li><p>Use RAII to automate cleanup of local resources</p></li>
<li><p>If 1) and 2) are followed religiously then only the code that <em>handles</em> an exception needs to catch it</p></li>
</ol>

<p><strong>Throwing an exception</strong></p>

<ol>
<li><p>Constructors - dealloc the value of other parts of the object, if necessary.</p></li>
<li><p>Mutators - first rollback the value of the object to initial value.</p></li>
</ol>

<p>Should not throw exceptions in:</p>

<ul>
<li><p>destructors</p>

<ul><li>needs to catch any exception thrown by its calls</li></ul></li>
<li><p>in copy constructor, assignment</p></li>
<li><p>accessors</p></li>
<li><p>in value operators (operator== operator*)</p></li>
</ul>

<p>Avouid exception specifications:</p>

<p>If the exceptions are only thrown at runtime, leave the exceptions out (or in comments).
It depends on what the compiler can check, but usually don't over-specialize the exception.</p>

<pre><code>int foo() throws (exception);
</code></pre>

<hr />             </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/* snip */</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Header file - set of declarations to be included in any module that uses declared name</p>

<p><strong>#include</strong> the header file to include external declarations in module.</p>

<p>Global Declarations:</p>

<ul>
<li><p>class declarations</p></li>
<li><p>void foo(int);</p>

<ul><li>function prototypes</li></ul></li>
<li><p>extern int i;</p>

<ul><li>variable declarations. (distinguishin declaration from definition)</li>
<li>in this case, extern is used to indicate that it should be exterally visible</li></ul></li>
<li><p>extern const int j = 100;</p>

<ul><li>global constants</li>
<li>extern used to indicate that the constant is global</li></ul></li>
</ul>

<hr />             </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/* snip */</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p><strong>Benefits of header files</strong></p>

<ul>
<li><p>abstract view of component</p></li>
<li><p>saves work</p></li>
<li><p>ensures consistency</p></li>
<li><p>easier maintenance</p></li>
</ul>

<hr />             </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/* snip */</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p><strong>Header Etiquette</strong></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/* snip */</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Checks if preprocessor name has been defined.</p>

<p>If false, code fragment (until endif) is included in compilation.</p>

<p>If we didn't include the #ifndef &amp; #def declarations, and we had circular dependencies, we can hit an <strong>infinite loop</strong> in the compiler.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="cp">#ifndef X </span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>defines existance of preprocessor variable. Refer to infinite loop, above.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="cp">#define X</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>ends the "#ifndef X"</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="cp">#endif</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 