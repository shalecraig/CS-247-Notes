<!DOCTYPE html>  <html> <head>   <title>07_handle_classes.cpp</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="05_tut1.html">                 05_tut1.cpp               </a>                                           <a class="source" href="06_adt_design.html">                 06_adt_design.cpp               </a>                                           <a class="source" href="07_handle_classes.html">                 07_handle_classes.cpp               </a>                                           <a class="source" href="08_designing_an_adt.html">                 08_designing_an_adt.cpp               </a>                                           <a class="source" href="09_mutable_adts.html">                 09_mutable_adts.cpp               </a>                                           <a class="source" href="10_singleton_design.html">                 10_singleton_design.cpp               </a>                                           <a class="source" href="11_error_handling.html">                 11_error_handling.cpp               </a>                                           <a class="source" href="12_exceptions.html">                 12_exceptions.cpp               </a>                                           <a class="source" href="13_resource_acquisition_is_initialization.html">                 13_resource_acquisition_is_initialization.cpp               </a>                                           <a class="source" href="14_make.html">                 14_make.sh               </a>                                           <a class="source" href="15_makefile.html">                 15_makefile.mak               </a>                                           <a class="source" href="16_interface_specifications.html">                 16_interface_specifications.h               </a>                                           <a class="source" href="17_namespaces.html">                 17_namespaces.cpp               </a>                                           <a class="source" href="18_namespaces_example.html">                 18_namespaces_example.cpp               </a>                                           <a class="source" href="19_uml.html">                 19_uml.cpp               </a>                                           <a class="source" href="20_substitutability.html">                 20_substitutability.cpp               </a>                                           <a class="source" href="AccountExample.html">                 AccountExample.cpp               </a>                                           <a class="source" href="TDD.html">                 TDD.cpp               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               07_handle_classes.cpp             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p><strong>Handle Classes</strong></p>

<ul>
<li><p>You can do pointer arithmetic to access private variables - this is bad.</p></li>
<li><p>Also, changing the .h files requires a complete re-compile of all code that derives from this.</p></li>
<li><p>To prevent this, we have a handle-class instead of doing what we said in <a href="./06_adt_design.html">Adt design #06</a></p></li>
<li><p>This is called a PIMPL (<strong>P</strong>ointer to <strong>IMPL</strong>ementation idiom): We basically have a class that has a pointer to the Implementation Class (which contains the implementation).</p></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <hr />             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p><strong><em>Rational.h file</em></strong></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nc">Rational</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Rational</span><span class="p">(</span><span class="kt">int</span> <span class="nl">num:</span> <span class="mi">0</span><span class="p">,</span> <span class="kt">int</span> <span class="nl">denom:</span> <span class="mi">1</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">numerator</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">denominator</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
<span class="k">private</span><span class="o">:</span>
    <span class="k">struct</span> <span class="n">impl</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>This is a PIMPL</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">impl</span> <span class="o">*</span><span class="n">rat_</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
    </pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>delete</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="o">~</span><span class="n">Rational</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>copy</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">Rational</span><span class="p">(</span><span class="k">const</span> <span class="o">&amp;</span><span class="n">Rational</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>assignment</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">Rational</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Rational</span><span class="p">);</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <hr />             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p><strong><em>Rational.cpp file</em></strong></p>

<p>We create a struct named Rational::Impl.</p>

<p>This allows us to modify the data members, and not have to worry about re-compiling everything.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">struct</span> <span class="n">Rational</span><span class="o">::</span><span class="n">Impl</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">num_</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">denom_</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Rational's constructor:</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="n">Rational</span><span class="o">::</span><span class="n">Rational</span><span class="p">(</span><span class="kt">int</span> <span class="n">num</span><span class="p">,</span> <span class="kt">int</span> <span class="n">denom</span><span class="p">)</span><span class="o">:</span> <span class="n">rat_</span><span class="p">(</span><span class="k">new</span> <span class="n">Rational</span><span class="o">::</span><span class="n">Impl</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>We have a single colon in method because we are using an initialization list.
This sets the values to what are in the brackets, basically allowing us to initialize the variables once.
If we had the same code inside the method, the compiler would set the value to 0, then change it when we set it (stupidly)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="n">denom</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">throw</span> <span class="s">&quot;Panic!&quot;</span><span class="p">;</span>
    <span class="n">rat_</span><span class="o">-&gt;</span><span class="n">num_</span> <span class="o">=</span> <span class="n">num</span><span class="p">;</span>
    <span class="n">rat_</span><span class="o">-&gt;</span><span class="n">denom_</span> <span class="o">=</span> <span class="n">denom</span><span class="p">;</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Destructor</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="n">Rational</span><span class="o">::~</span><span class="n">Rational</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>This deallocates rat</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">delete</span> <span class="n">_rat</span><span class="p">;</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Initialization example (deep)</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="n">Rational</span><span class="o">::</span><span class="n">Rational</span><span class="p">(</span><span class="k">const</span> <span class="n">Rational</span><span class="o">&amp;</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>copies the values of num_ and denom_ from the other rational.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="o">*</span><span class="n">rat_</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">rat_</span><span class="p">);</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Copy example (deep);</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="n">Rational</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Rational</span><span class="o">&amp;</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Running a = a fails if we remove this line (we delete left side before copying the right side)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">r</span> <span class="o">==</span> <span class="k">this</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">delete</span> <span class="n">rat_</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Copy the values inside r.rat<em>, don't reference them. If this was a shallow copy, we would run this instead:
           rat</em> = r.rat_</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">rat_</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Rational</span><span class="o">::</span><span class="n">Impl</span><span class="p">(</span><span class="o">*</span><span class="n">r</span><span class="p">.</span><span class="n">rat_</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <hr />

<p>random code for code snippets:</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>initialized as 0/1</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">Rational</span> <span class="n">r</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>initialized as 0/1</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">Rational</span> <span class="n">s</span><span class="p">(</span><span class="n">r</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>change the value of r</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">r</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>If s(r) is a <em>shallow</em> copy, we would output r = 10/1, s = 10/1.
If s(r) is a <em>deep</em> copy, we would output r = 10/1, s = 0/1</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;r= &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">r</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, s= &quot;</span><span class="p">,</span> <span class="o">&lt;&lt;</span> <span class="n">s</span><span class="p">;</span>
<span class="p">}</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 